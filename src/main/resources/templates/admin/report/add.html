<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro" th:include="layout/layout">
        <div class="container-fluid" th:fragment="content">
			<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
				<legend>报告上传</legend>
			</fieldset>
			<form>
				<div class="form-group">
					<label>姓名</label>
					<input style="width: 720px" th:readonly="readonly" th:value="${name}" type="text"  id="studentName" name="studentName" class="form-control" placeholder="提交者名字">
				</div>
				<div class="form-group">
					<label>报告类型:</label>
					<select id="typeId" name="typeId"></select>
				</div>
				<script type="text/javascript" src="/static/js/wangEditor.min.js"></script>
				<label>论文留言</label><div id="detail"></div>

				<div class="form-group">
					<label>报告上传</label><br>
					<input type="file" id="file" name="file" class="form-control" >
				</div>

				<button type="submit" id="btn" class="btn btn-xs btn-primary">保存</button>
			</form>

			<script>
				var E = window.wangEditor
				editor = new E('#detail')
				editor.customConfig.menus = [
					'head',  // 标题
					'bold',  // 粗体
					'fontSize',  // 字号
					'fontName',  // 字体
					'italic',  // 斜体
					'underline',  // 下划线
					'strikeThrough',  // 删除线
					'foreColor',  // 文字颜色
					'backColor',  // 背景颜色
					'link',  // 插入链接
					'list',  // 列表
					'justify',  // 对齐方式
					'quote',  // 引用
					// 表情
					// 'image',// 插入图片
					'table',  // 表格
					// 插入视频
					// 插入代码
					'undo',  // 撤销
					'redo'  // 重复
				]
				editor.create()


				list4()
				function list4() {
					$.ajax({
						url: '/api/v1/type/list',
						type: 'get',
						// cache: false,
						// async: false,
						contentType: 'application/json',
						success: function(data) {
							var modelList = data.data.info;
							if(modelList && modelList.length != 0){
								for(var i=0; i<modelList.length; i++){
									var option="<option value=\""+modelList[i].id+"\"";
									option += ">"+modelList[i].name+"</option>";
									$("select[id=typeId]").append(option);
								}
							}
						}
					})
				}

				$("#btn").click(function () {
					var formData = new FormData();
					formData.append("files", $("#file")[0].files[0]);
					$.ajax({
						type:'POST',
						url:"/api/v1/document/upload",
						data:formData,
						contentType:false,
						processData:false,//这个很有必要，不然不行
						dataType:"json",
						mimeType:"multipart/form-data",
						success:function(data){
							if (data.meta.success) {
								submitForm(data.data);
							} else {
								toast(data.meta.message);
							}
						}
					})
				});
				function submitForm(urlId) {
					var detail=editor.txt.html();
					// var content = $("#content").val();
					var typeId = $("#typeId option:selected").val();
					console.log(typeId);
					$.ajax({
						url: '/api/v1/report/add',
						cache: false,
						async: false,
						type: 'post',
						dataType: 'json',
						contentType: 'application/json;charset=UTF-8',
						data: JSON.stringify({
							content:detail,
							filesId:urlId,
							type:typeId
						}),
						success: function (data) {
							if (data.meta.success) {
								toast("提交成功", "success");
								window.location.href = "/report/list"
							} else {
								toast(data.meta.message);
							}
						}
					});

				}
			</script>
        </div>

</html>
