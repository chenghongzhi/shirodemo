<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro" th:include="layout/layout">
<div class="container-fluid" th:fragment="content">
			<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
				<legend>报告详情</legend>
			</fieldset>
			<div style="width: 750px;float: left">
			<form>
				<input type="hidden" id="id" name="id" th:value="${report.getId()}">
				<div class="form-group">
					<label>姓名:</label>
					<input type="text" th:readonly="readonly" style="width: 720px;" th:value="${report.getStudentName()}" id="studentName" name="studentName" class="form-control" placeholder="提交者名字">
				</div>

				<div class="form-group">
					<label>留言:</label><br>
					<div style="width: 720px;background: #eee" th:utext="${report.getContent()}"></div>
				</div>

				<script type="text/javascript" src="/static/js/wangEditor.min.js"></script>
				<label>论文批注:</label>
				<div id="detail">
					<p th:utext="${report.getTeacherSuggestion()}"></p>
				</div><br>

				<div class="form-group">
					<label>附件下载:</label>
					<a th:href="${report.getFileUrl()}">
						<span th:text="${report.getFileName()}"></span>
					</a>
				</div>
				<input th:if="${report.getState() != 3}" type="button" style="width: 50px;float: left;margin-right: 10px" id="pass" th:onclick="'javascript:addUser();'" class="btn btn-primary btn-block " value="完成" />
				<input th:if="${report.getState() != 3}" type="button" style="width: 70px;" id="nopass" th:onclick="'javascript:addUsers();'" class="btn btn-primary btn-block " value="需修改" />
			</form>
			</div>
			<div style="width: calc(40% - 40px);height:650px;float:left;overflow: auto">
				<ul class="layui-timeline" th:each="list : ${recordsList}">
					<li class="layui-timeline-item">
						<i class="layui-icon layui-timeline-axis">&#xe63f;</i>
						<div class="layui-timeline-content layui-text">
							<h3 th:text="${#dates.format(list.getTime(),'yyyy-MM-dd HH:mm:ss')}" class="layui-timeline-title"></h3>
							<p th:utext="${list.getSuggestion()}"></p>
						</div>
					</li>
				</ul>
			</div>
			<script>
				var E = window.wangEditor
				editor = new E('#detail')
				editor.customConfig.menus = [
					'head',  // 标题
					'bold',  // 粗体
					'fontSize',  // 字号
					'fontName',  // 字体
					'italic',  // 斜体
					'underline',  // 下划线
					'strikeThrough',  // 删除线
					'foreColor',  // 文字颜色
					'backColor',  // 背景颜色
					'link',  // 插入链接
					'list',  // 列表
					'justify',  // 对齐方式
					'quote',  // 引用
					// 表情
					// 'image',// 插入图片
					'table',  // 表格
					// 插入视频
					// 插入代码
					'undo',  // 撤销
					'redo'  // 重复
				]
				editor.create()


				function addUser() {
					var id = $("#id").val();
					var remark=editor.txt.html();
					// var remark = $("#remark").val();
					var pass = 3
					$.ajax({
						url: '/api/v1/report/edit',
						type: 'post',
						contentType: 'application/json',
						data: JSON.stringify({
							id: id,
							teacherSuggestion:remark,
							state:pass
						}),
						success: function(data) {
							if (data.meta.success == true) {
								window.location.href = "/report/list";
								return true;
							} else {
								toast(data.meta.message);
								return false;
							}
						}

					})
				}
				function addUsers() {
					var id = $("#id").val();
					var remark=editor.txt.html();
					// var remark = $("#remark").val();
					var pass = 2
					$.ajax({
						url: '/api/v1/report/edit',
						type: 'post',
						contentType: 'application/json',
						data: JSON.stringify({
							id: id,
							teacherSuggestion:remark,
							state:pass
						}),
						success: function(data) {
							if (data.meta.success == true) {
								window.location.href = "/report/list";
								return true;
							} else {
								toast(data.meta.message);
								return false;
							}
						}

					})
				}
			</script>
        </div>
</html>
